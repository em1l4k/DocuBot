"""
–ö–æ–º–∞–Ω–¥—ã –ø–æ–º–æ—â–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
"""
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.filters import Command
from bot.rbac import Permission, Role
from bot.handlers.keyboards.keyboards import (
    get_main_keyboard, get_search_keyboard, get_archive_keyboard,
    get_reminders_keyboard, get_admin_keyboard
)


async def help_command(message: Message, current_user):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º"""
    try:
        text = "‚ùì <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ DocuBot</b>\n\n"
        
        # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
        text += "üìã <b>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
        text += "‚Ä¢ <code>/start</code> - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞\n"
        text += "‚Ä¢ <code>/profile</code> - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n"
        text += "‚Ä¢ <code>/my_docs</code> - –º–æ–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ <code>/upload</code> - –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç\n\n"
        
        # –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        text += "üîç <b>–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:</b>\n"
        text += "‚Ä¢ <code>/search [–∑–∞–ø—Ä–æ—Å]</code> - –ø–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\n"
        text += "‚Ä¢ <code>/filters</code> - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã\n"
        text += "‚Ä¢ <code>/recent</code> - –Ω–µ–¥–∞–≤–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ <code>/overdue</code> - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n\n"
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        text += "üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>\n"
        text += "‚Ä¢ <code>/stats</code> - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
        text += "‚Ä¢ <code>/my_stats</code> - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
        text += "‚Ä¢ <code>/storage_stats</code> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞\n\n"
        
        # –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
        if current_user.has_permission(Permission.APPROVE_DOCUMENTS):
            text += "‚è≥ <b>–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ:</b>\n"
            text += "‚Ä¢ <code>/pending</code> - –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ\n"
            text += "‚Ä¢ <code>/approval_history</code> - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π\n"
            text += "‚Ä¢ <code>/approval_stats</code> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π\n\n"
        
        # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        text += "‚è∞ <b>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:</b>\n"
        text += "‚Ä¢ <code>/approaching</code> - –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è –∫ –¥–µ–¥–ª–∞–π–Ω—É\n"
        text += "‚Ä¢ <code>/reminder_stats</code> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n"
        text += "‚Ä¢ <code>/my_reminder_stats</code> - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n\n"
        
        # –ê—Ä—Ö–∏–≤
        text += "üì¶ <b>–ê—Ä—Ö–∏–≤:</b>\n"
        text += "‚Ä¢ <code>/archived</code> - –∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ <code>/archive_stats</code> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞\n"
        text += "‚Ä¢ <code>/archive [id] [–ø—Ä–∏—á–∏–Ω–∞]</code> - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å\n"
        text += "‚Ä¢ <code>/unarchive [id]</code> - —Ä–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å\n\n"
        
        # –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
        if current_user.role == Role.admin:
            text += "üõ†Ô∏è <b>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:</b>\n"
            text += "‚Ä¢ <code>/admin</code> - –≥–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å\n"
            text += "‚Ä¢ <code>/users</code> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n"
            text += "‚Ä¢ <code>/system_stats</code> - —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
            text += "‚Ä¢ <code>/overdue_all</code> - –≤—Å–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ\n"
            text += "‚Ä¢ <code>/user_stats</code> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n"
            text += "‚Ä¢ <code>/reload_whitelist</code> - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å whitelist\n"
            text += "‚Ä¢ <code>/auto_archive [–¥–Ω–∏]</code> - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏–≤–∞—Ü–∏—è\n\n"
        
        # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        text += "‚å®Ô∏è <b>–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:</b>\n"
        text += "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n"
        text += "‚Ä¢ –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –≤–∞—à—É —Ä–æ–ª—å\n"
        text += "‚Ä¢ –í—Å–µ–≥–¥–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'\n\n"
        
        # –ü–æ–¥—Å–∫–∞–∑–∫–∏
        text += "üí° <b>–ü–æ–¥—Å–∫–∞–∑–∫–∏:</b>\n"
        text += "‚Ä¢ –ü—Ä–∏—à–ª–∏—Ç–µ PDF/DOCX —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏\n"
        text += "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n"
        text += "‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 —Å–µ–∫\n"
        text += "‚Ä¢ –î–ª—è –æ—Ç–º–µ–Ω—ã —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /keep\n\n"
        
        text += "üÜò <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b>\n"
        text += "‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö\n"
        text += "‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ"
        
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –±—ã—Å—Ç—Ä—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [
                InlineKeyboardButton(text="üìÑ –ú–æ–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã", callback_data="quick_my_docs"),
                InlineKeyboardButton(text="üîç –ü–æ–∏—Å–∫", callback_data="quick_search")
            ],
            [
                InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="quick_stats"),
                InlineKeyboardButton(text="‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è", callback_data="quick_reminders")
            ],
            [
                InlineKeyboardButton(text="üì¶ –ê—Ä—Ö–∏–≤", callback_data="quick_archive"),
                InlineKeyboardButton(text="üë§ –ü—Ä–æ—Ñ–∏–ª—å", callback_data="quick_profile")
            ]
        ])
        
        await message.answer(text, reply_markup=keyboard, parse_mode="HTML")
        
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏: {e}")


async def commands_command(message: Message, current_user):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥"""
    try:
        text = "üìã <b>–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</b>\n\n"
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        categories = {
            "–û—Å–Ω–æ–≤–Ω—ã–µ": [
                "/start - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞",
                "/profile - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", 
                "/my_docs - –º–æ–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
                "/upload - –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç"
            ],
            "–ü–æ–∏—Å–∫": [
                "/search [–∑–∞–ø—Ä–æ—Å] - –ø–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
                "/filters - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",
                "/recent - –Ω–µ–¥–∞–≤–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
                "/overdue - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã"
            ],
            "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞": [
                "/stats - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                "/my_stats - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                "/storage_stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
            ],
            "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è": [
                "/approaching - –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è –∫ –¥–µ–¥–ª–∞–π–Ω—É",
                "/reminder_stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π",
                "/my_reminder_stats - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
            ],
            "–ê—Ä—Ö–∏–≤": [
                "/archived - –∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
                "/archive_stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞",
                "/archive [id] [–ø—Ä–∏—á–∏–Ω–∞] - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å",
                "/unarchive [id] - —Ä–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å"
            ]
        }
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –∞–¥–º–∏–Ω–æ–≤
        if current_user.has_permission(Permission.APPROVE_DOCUMENTS):
            categories["–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ"] = [
                "/pending - –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
                "/approval_history - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π",
                "/approval_stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π"
            ]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
        if current_user.role == Role.admin:
            categories["–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"] = [
                "/admin - –≥–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
                "/users - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",
                "/system_stats - —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                "/overdue_all - –≤—Å–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ",
                "/user_stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
                "/reload_whitelist - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å whitelist",
                "/auto_archive [–¥–Ω–∏] - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏–≤–∞—Ü–∏—è"
            ]
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
        for category, commands in categories.items():
            text += f"<b>{category}:</b>\n"
            for command in commands:
                text += f"‚Ä¢ <code>{command}</code>\n"
            text += "\n"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞—Ö
        text += "‚å®Ô∏è <b>–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:</b>\n"
        text += "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n"
        text += "‚Ä¢ –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –≤–∞—à—É —Ä–æ–ª—å\n"
        text += "‚Ä¢ –í—Å–µ–≥–¥–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'\n\n"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —É–¥–∞–ª–µ–Ω–∏–∏
        text += "üßπ <b>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:</b>\n"
        text += "‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥\n"
        text += "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /keep –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n"
        text += "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /cleanup –¥–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏\n\n"
        
        text += "üí° <b>–°–æ–≤–µ—Ç:</b> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º!"
        
        await message.answer(text, parse_mode="HTML")
        
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥: {e}")


async def keep_command(message: Message, current_user):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä–≤–∏—Å –æ—á–∏—Å—Ç–∫–∏
        from bot.services.cleanup import get_cleanup_service
        from aiogram import Bot
        from bot.config import BOT_TOKEN
        
        bot = Bot(token=BOT_TOKEN)
        cleanup_service = get_cleanup_service(bot)
        
        # –û—Ç–º–µ–Ω—è–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        success = await cleanup_service.delete_message_immediately(message)
        
        if success:
            await message.answer(
                "‚úÖ <b>–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</b>\n\n"
                "–≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–æ.\n"
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /cleanup –¥–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏.",
                parse_mode="HTML"
            )
        else:
            await message.answer(
                "‚ùå <b>–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</b>\n\n"
                "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.",
                parse_mode="HTML"
            )
        
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")


async def cleanup_command(message: Message, current_user):
    """–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä–≤–∏—Å –æ—á–∏—Å—Ç–∫–∏
        from bot.services.cleanup import get_cleanup_service
        from aiogram import Bot
        from bot.config import BOT_TOKEN
        
        bot = Bot(token=BOT_TOKEN)
        cleanup_service = get_cleanup_service(bot)
        
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤
        active_timers = cleanup_service.get_active_timers_count()
        
        await message.answer(
            f"üßπ <b>–û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π</b>\n\n"
            f"üìä –ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤ —É–¥–∞–ª–µ–Ω–∏—è: {active_timers}\n"
            f"‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ: {'–í–∫–ª—é—á–µ–Ω–æ' if cleanup_service.auto_delete_enabled else '–û—Ç–∫–ª—é—á–µ–Ω–æ'}\n"
            f"üïê –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: {cleanup_service.default_delete_delay} —Å–µ–∫\n\n"
            f"üí° <b>–ü–æ–¥—Å–∫–∞–∑–∫–∏:</b>\n"
            f"‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /keep –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n"
            f"‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥\n"
            f"‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞",
            parse_mode="HTML"
        )
        
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—á–∏—Å—Ç–∫–µ: {e}")


async def keyboard_command(message: Message, current_user):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"""
    try:
        text = "‚å®Ô∏è <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</b>\n\n"
        
        # –û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        text += "üè† <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:</b>\n"
        text += "‚Ä¢ üìÑ –ú–æ–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã - –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\n"
        text += "‚Ä¢ üîç –ü–æ–∏—Å–∫ - –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è\n"
        text += "‚Ä¢ üë§ –ü—Ä–æ—Ñ–∏–ª—å - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ\n"
        text += "‚Ä¢ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
        text += "‚Ä¢ üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤\n"
        text += "‚Ä¢ ‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ üì¶ –ê—Ä—Ö–∏–≤ - –∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ ‚ùì –ü–æ–º–æ—â—å - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º\n\n"
        
        # –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–∏—Å–∫–∞
        text += "üîç <b>–ü–æ–∏—Å–∫:</b>\n"
        text += "‚Ä¢ üîç –ü–æ–∏—Å–∫ - –ø–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\n"
        text += "‚Ä¢ üìÖ –ù–µ–¥–∞–≤–Ω–∏–µ - –Ω–µ–¥–∞–≤–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ ‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ üìã –§–∏–ª—å—Ç—Ä—ã - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã\n"
        text += "‚Ä¢ üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é - –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n\n"
        
        # –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∞—Ä—Ö–∏–≤–∞
        text += "üì¶ <b>–ê—Ä—Ö–∏–≤:</b>\n"
        text += "‚Ä¢ üì¶ –ê—Ä—Ö–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã - –ø—Ä–æ—Å–º–æ—Ç—Ä –∞—Ä—Ö–∏–≤–∞\n"
        text += "‚Ä¢ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞ - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞\n"
        text += "‚Ä¢ üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é - –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n\n"
        
        # –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
        text += "‚è∞ <b>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:</b>\n"
        text += "‚Ä¢ ‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        text += "‚Ä¢ ‚è∞ –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è - –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è –∫ –¥–µ–¥–ª–∞–π–Ω—É\n"
        text += "‚Ä¢ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
        text += "‚Ä¢ üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é - –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n\n"
        
        # –ê–¥–º–∏–Ω—Å–∫–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        if current_user.role == Role.admin:
            text += "üõ†Ô∏è <b>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:</b>\n"
            text += "‚Ä¢ üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n"
            text += "‚Ä¢ üìä –°–∏—Å—Ç–µ–º–∞ - —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
            text += "‚Ä¢ ‚ö†Ô∏è –í—Å–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ - –≤—Å–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
            text += "‚Ä¢ üì¶ –ê—Ä—Ö–∏–≤ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–æ–º\n"
            text += "‚Ä¢ üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å whitelist - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ whitelist\n"
            text += "‚Ä¢ üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é - –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n\n"
        
        text += "üí° <b>–°–æ–≤–µ—Ç:</b> –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –≤–∞—à—É —Ä–æ–ª—å –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞!"
        
        await message.answer(text, parse_mode="HTML")
        
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞—Ö: {e}")
